/*! Knockout Sync - v0.1.0 - 2013-04-12
* https://github.com/katowulf/knockout-sync
* Copyright (c) 2013 Michael "Kato" Wulf; Licensed MIT, GPL */


(function(){var e=!1,t=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(n){function o(){!e&&this.init&&this.init.apply(this,arguments)}var r=this.prototype;e=!0;var i=new this;e=!1;for(var s in n)i[s]=typeof n[s]=="function"&&typeof r[s]=="function"&&t.test(n[s])?function(e,t){return function(){var n=this._super;this._super=r[e];var i=t.apply(this,arguments);return this._super=n,i}}(s,n[s]):n[s];return o.prototype=i,o.prototype.constructor=o,o.extend=arguments.callee,o}})(),function(e){e||(e=window.console={log:function(e,t,n,r,i){},info:function(e,t,n,r,i){},warn:function(e,t,n,r,i){},error:function(e,t,n,r,i){}}),Function.prototype.bind||(Function.prototype.bind=function(e){var t=this,n=Array.prototype.slice.call(arguments,1);return function(){return t.apply(e,Array.prototype.concat.apply(n,arguments))}}),typeof e.log=="object"&&(e.log=Function.prototype.call.bind(e.log,e),e.info=Function.prototype.call.bind(e.info,e),e.warn=Function.prototype.call.bind(e.warn,e),e.error=Function.prototype.call.bind(e.error,e)),"group"in e||(e.group=function(t){e.info("\n------------\n"+t+"\n------------")}),"groupEnd"in e||(e.groupEnd=function(){}),"time"in e||function(){var t={};e.time=function(e){t[e]=(new Date).getTime()},e.timeEnd=function(n){var r=(new Date).getTime(),i=n in t?r-t[n]:0;e.info(n+": "+i+"ms")}}()}(window.console),function(e){"use strict";if(!e._){var t=Array.prototype,n={},r=t.push,i=Object.prototype.hasOwnProperty,s=t.forEach,o=Array.isArray,u=Object.prototype.toString,a=t.map,f=t.concat,l=e._={},c=l.each=function(e,t,r){if(e==null)return;if(s&&e.forEach===s)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,o=e.length;i<o;i++)if(t.call(r,e[i],i,e)===n)return}else for(var u in e)if(e.hasOwnProperty(u)&&t.call(r,e[u],u,e)===n)return},h=function(e,t,n,r){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;var i=u.call(e);if(i!=u.call(t))return!1;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return!1;var s=n.length;while(s--)if(n[s]==e)return r[s]==t;n.push(e),r.push(t);var o=0,a=!0;if(i=="[object Array]"){o=e.length,a=o==t.length;if(a)while(o--)if(!(a=h(e[o],t[o],n,r)))break}else{var f=e.constructor,c=t.constructor;if(f!==c&&!(l.isFunction(f)&&f instanceof f&&l.isFunction(c)&&c instanceof c))return!1;for(var p in e)if(l.has(e,p)){o++;if(!(a=l.has(t,p)&&h(e[p],t[p],n,r)))break}if(a){for(p in t)if(l.has(t,p)&&!(o--))break;a=!o}}return n.pop(),r.pop(),a};l.isEqual=function(e,t){return h(e,t,[],[])},l.isEmpty=function(e){if(e==null)return!0;if(l.isArray(e)||l.isString(e))return e.length===0;for(var t in e)if(l.has(e,t))return!1;return!0},l.isArray=o||function(e){return u.call(e)=="[object Array]"},l.isObject=function(e){return e===Object(e)},c(["Arguments","Function","String","Number","Date","RegExp"],function(e){l["is"+e]=function(t){return u.call(t)=="[object "+e+"]"}}),l.isArguments(arguments)||(l.isArguments=function(e){return!!e&&!!l.has(e,"callee")}),typeof /./!="function"&&(l.isFunction=function(e){return typeof e=="function"}),l.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},l.isNaN=function(e){return l.isNumber(e)&&e!=+e},l.isBoolean=function(e){return e===!0||e===!1||u.call(e)=="[object Boolean]"},l.isNull=function(e){return e===null},l.isUndefined=function(e){return e===void 0},l.has=function(e,t){return i.call(e,t)},l.mixin=function(e){c(e,function(e,t){l[t]=e})},l.toArray=function(e){return e?l.isArray(e)?slice.call(e):e.length===+e.length?l.map(e,l.identity):l.values(e):[]},l.map=l.collect=function(e,t,n){var r=[];return e==null?r:a&&e.map===a?e.map(t,n):(c(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),r)},l.pick=function(e){var n={},r=f.apply(t,slice.call(arguments,1));return c(r,function(t){t in e&&(n[t]=e[t])}),n},l.debounce=function(e,t,n){var r,i;return function(){var s=this,o=arguments,u=function(){r=null,n||(i=e.apply(s,o))},a=n&&!r;return clearTimeout(r),r=setTimeout(u,t),a&&(i=e.apply(s,o)),i}}}}(window),function(e){function t(e,t){function f(e,t,s){var f=[e,t];s&&Array.prototype.push.apply(f,s),r++,t!=="resolved"&&u++,n.notify.apply(n,f),o[e]=f.slice(1),r===i&&(a&&clearTimeout(a),u?n.reject(o):n.resolve(o))}var n=_.Deferred(),r=0,i=t.length,s=!1,o=[],u=0,a;return e&&(a=setTimeout(function(){s=!0,_.each(t,function(e,t){e&&typeof e=="object"&&e.promise&&e.state&&e.state()==="pending"&&f(t,"expired")})},e)),i?_.each(t,function(e,t){setTimeout(function(){_.when(e).then(function(){s||f(t,"resolved",_.toArray(arguments))},function(){s||f(t,"rejected",_.toArray(arguments))})},0)}):n.resolve(o),n.promise()}e._.mixin({move:function(e,t,n){if(t===n)return;e.splice(n,0,e.splice(t,1)[0])},whenAll:function(){return t(0,_.toArray(arguments))},whenAllExpires:function(e){return t(e,_.toArray(arguments).slice(1))}})}(window),function(e){function g(e){var t=m[e]={};return f(e.split(/\s+/),function(e){t[e]=!0}),t}var t={},n=Array.prototype,r=Object.prototype,i=r.hasOwnProperty,s=r.toString,o=n.forEach,u=n.indexOf,a=n.slice,f=function(e,n,r){var s,u,a;if(!e)return;if(o&&e.forEach===o)e.forEach(n,r);else if(e.length===+e.length){for(u=0,a=e.length;u<a;u++)if(u in e&&n.call(r,e[u],u,e)===t)return}else for(s in e)if(i.call(e,s)&&n.call(r,e[s],s,e)===t)return},l=function(e){return!!(e&&e.constructor&&e.call&&e.apply)},c=function(e){return f(a.call(arguments,1),function(t){var n;for(n in t)t[n]!==void 0&&(e[n]=t[n])}),e},h=function(e,t,n){var r;if(t){if(u)return u.call(t,e,n);r=t.length,n=n?n<0?Math.max(0,r+n):n:0;for(;n<r;n++)if(n in t&&t[n]===e)return n}return-1},p={};f("Boolean Number String Function Array Date RegExp Object".split(" "),function(e,t){p["[object "+e+"]"]=e.toLowerCase()});var d=function(e){return e==null?String(e):p[s.call(e)]||"object"},v={},m={};v.Callbacks=function(e){e=typeof e=="string"?m[e]||g(e):c({},e);var t,n,r,i,s,o,u=[],a=!e.once&&[],l=function(f){t=e.memory&&f,n=!0,o=i||0,i=0,s=u.length,r=!0;for(;u&&o<s;o++)if(u[o].apply(f[0],f[1])===!1&&e.stopOnFalse){t=!1;break}r=!1,u&&(a?a.length&&l(a.shift()):t?u=[]:p.disable())},p={add:function(){if(u){var n=u.length;(function o(t){f(t,function(t){var n=d(t);n==="function"?(!e.unique||!p.has(t))&&u.push(t):t&&t.length&&n!=="string"&&o(t)})})(arguments),r?s=u.length:t&&(i=n,l(t))}return this},remove:function(){return u&&f(arguments,function(e){var t;while((t=h(e,u,t))>-1)u.splice(t,1),r&&(t<=s&&s--,t<=o&&o--)}),this},has:function(e){return h(e,u)>-1},empty:function(){return u=[],this},disable:function(){return u=a=t=undefined,this},disabled:function(){return!u},lock:function(){return a=undefined,t||p.disable(),this},locked:function(){return!a},fireWith:function(e,t){return t=t||[],t=[e,t.slice?t.slice():t],u&&(!n||a)&&(r?a.push(t):l(t)),this},fire:function(){return p.fireWith(this,arguments),this},fired:function(){return!!n}};return p},v.Deferred=function(e){var t=[["resolve","done",v.Callbacks("once memory"),"resolved"],["reject","fail",v.Callbacks("once memory"),"rejected"],["notify","progress",v.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return v.Deferred(function(n){f(t,function(t,r){var s=t[0],o=e[r];i[t[1]](l(o)?function(){var e;try{e=o.apply(this,arguments)}catch(t){n.reject(t);return}e&&l(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[s!=="notify"?"resolveWith":s+"With"](this===i?n:this,[e])}:n[s])}),e=null}).promise()},promise:function(e){return e!=null?c(e,r):r}},i={};return r.pipe=r.then,f(t,function(e,s){var o=e[2],u=e[3];r[e[1]]=o.add,u&&o.add(function(){n=u},t[s^1][2].disable,t[2][2].lock),i[e[0]]=o.fire,i[e[0]+"With"]=o.fireWith}),r.promise(i),e&&e.call(i,i),i},v.when=function(e){var t=0,n=d(e)==="array"&&arguments.length===1?e:a.call(arguments),r=n.length;d(e)==="array"&&e.length===1&&(e=e[0]);var i=r!==1||e&&l(e.promise)?r:0,s=i===1?e:v.Deferred(),o=function(e,t,n){return function(r){t[e]=this,n[e]=arguments.length>1?a.call(arguments):r,n===u?s.notifyWith(t,n):--i||s.resolveWith(t,n)}},u,f,c;if(r>1){u=new Array(r),f=new Array(r),c=new Array(r);for(;t<r;t++)n[t]&&l(n[t].promise)?n[t].promise().done(o(t,c,n)).fail(s.reject).progress(o(t,f,u)):--i}return i||s.resolveWith(c,n),s.promise()},typeof module!="undefined"&&module.exports?module.exports=v:typeof e._!="undefined"?e._.mixin(v):e._=v}(this),function(e){"use strict";var t;e.sync={stores:{},isObservableArray:function(t){return typeof t=="function"&&!!e.isObservable(t)&&!!t.splice&&_.isArray(t())},unwrapAll:function(t){var n=e.utils.unwrapObservable;t=n(t);var r=_.isArray(t)?[]:{};return _.each(t,function(t,i){t=n(t),r[i]=_.isObject(t)?e.sync.unwrapAll(t):t}),r},prepStoreData:function(t,n){return t?_.pick(e.sync.unwrapAll(t),n.getFieldNames()):t},applyUpdates:function(t,n){if(n){var r=e.isObservable(t),i=e.utils.extend({},e.utils.unwrapObservable(t)||{});_.each(n,function(t,n){e.isObservable(i[n])?i[n](t):i[n]=t}),r?t(i):t=i}return t}},e.extenders.sync=function(t,n){n=e.utils.extend({},n);var r=n.store;if(r instanceof e.sync.Store)return e.sync.isObservableArray(t)?(t.crud=new e.sync.CrudArray(t,r,n.factory),t.crud.read()):(t.crud=new e.sync.Crud(t,r),n.key?t.crud.read(n.key):_.isObject(e.utils.unwrapObservable(t))&&t.crud.create()),t;throw new Error("Must declare a store to sync any observable")},e.observable.fn.watchChanges=function(n,r){var i,s,o=null;return s=this.subscribe(function(t){o=e.sync.unwrapAll(t)},t,"beforeChange"),i=this.subscribe(function(t){t=e.sync.unwrapAll(t),_.isEqual(t,o)||r(t)}),{dispose:function(){i&&i.dispose(),s&&s.dispose()}}},e.observableArray.fn.watchChanges=function(t,n){return this.watcher?this.watcher.add(n):(this.watcher=new e.sync.ArrayWatcher(this,t),this.watcher.add(n)),this}}(window.ko),function(){"use strict";function e(e,n,r){var i={},s=null,o=0;return t(e,n,r,function(e,t,n,r){_.isEqual(n,t)?r!==o&&(i[e]={status:"move",prevId:s,idx:o}):n===undefined?i[e]={status:"create",data:t,prevId:s,idx:o}:t===undefined?i[e]={status:"delete"}:i[e]={status:"update",data:t,prevId:s,idx:o},t!==undefined&&(o++,s=e),i[e]&&console.log("changed",e,i[e].status,i[e].idx)}),i}function t(e,t,r,i){var s=null,o=n(e,r),u=0;_.each(t||[],function(t){var n=e.getKey(t),r=o[n]||{};i(n,r.value,t,u++),s=n,delete o[n]}),_.each(o,function(e,t){i(t,e.value,undefined,-1)})}function n(e,t){var n={},r=null;return ko.utils.arrayForEach(t||[],function(t){var i=e.getKey(t);n[i]={value:t,prevKey:r},r=i}),n}ko.sync.ArrayWatcher=function(t,n){var r,i,s,o=[];i=t.subscribe(function(e){s=ko.sync.unwrapAll(e)},undefined,"beforeChange"),r=t.subscribe(function(t){var r=e(n,s,t);_.each(o,function(e){e(r)})}),this.dispose=function(){r&&r.dispose(),i&&i.dispose()},this.add=function(e){o.push(e)}}}(),function(e){"use strict";e.sync.Crud=function(e,t){this.observable=e,this.store=t,this.ready=_.Deferred().resolve()},e.utils.extend(e.sync.Crud.prototype,{create:function(t){return this._then(function(){t&&e.sync.applyUpdates(this.observable,t);var n=e.sync.prepStoreData(this.observable,this.store);return _.when(this.store.create(n)).done(function(e){this.key=e,this._sync()}.bind(this))})},read:function(e){return this._then(function(){return this.key=e,_.when(this.store.read(e)).done(function(e){this._change(this.observable,e),this._sync()}.bind(this))})},update:function(t){return this._then(function(){t&&this.observable(e.utils.extend(this.observable(),t));var n=e.sync.prepStoreData(this.observable,this.store);return _.when(this.store.update(this.key,n))})},"delete":function(){return this._then(function(){return _.when(this.store.delete(this.key))})},_sync:function(){this.store.on("create update delete",this.key,this._change.bind(this)),this.observable.watchChanges(this.store,this._local.bind(this))},_change:function(t,n){e.sync.applyUpdates(this.observable,n)},_local:function(t){this.store.update(this.key,e.sync.prepStoreData(t,this.store))},_then:function(e){return e=e.bind(this),this.ready=this.ready.then(function(){var t=_.Deferred();return _.when(e()).always(t.resolve),t}),this}})}(window.ko),function(e){"use strict";function t(t,n){if(!n)return!1;t=e.sync.unwrapAll(t);var r;for(r in n)if(n.hasOwnProperty(r)&&!_.isEqual(t[r],n[r]))return console.log("change found",r,t[r],n[r]),!0;return!1}function n(e){var t=setTimeout(e.resolve,1e3),n=_.debounce(e.resolve,100),r=!0;return e.always(function(){console.log("resolved")}),function(){t&&(clearTimeout(t),t=null),r&&(console.log("unresolved"),n(),r=e.state()==="pending")}}e.sync.CrudArray=function(t,n,r){this.obs=t,this.store=n,this._map=new e.sync.KeyMap(n,t),this.factory=r||new e.sync.Factory(n),this.ready=_.Deferred().resolve()},e.utils.extend(e.sync.CrudArray.prototype,{create:function(e){return this._then(function(){var t=0;return _.isArray(e)||(e=e?[e]:[]),_.each(e,function(e){this._create(this.store.getKey(e),e)>=0&&t++}.bind(this)),t})},read:function(){return this._then(function(){var t=_.Deferred(),r=n(t);return this.store.on("create",function(){this._create.apply(this,e.utils.makeArray(arguments)),r()}.bind(this)),this.store.on("update",this._update.bind(this)),this.store.on("delete",this._delete.bind(this)),this.obs.watchChanges(this.store,this._local.bind(this)),t})},update:function(e,t){return this._then(function(){return this._update(e,t)>=0?(console.log("CrudArray:update",e),e):(console.warn("CrudArray::update - invalid key (not in local data)",e),!1)})},"delete":function(e){return this._then(function(){var t=this._map.indexOf(e);return t>-1?this.obs.splice(t,1):!1})},_create:function(e,t){var n=this._map.indexOf(e);return n<0?this.obs.push(this.factory.make(e,t)):(this._update(e,t),-1)},_update:function(n,r){var i=this._map.indexOf(n),s;if(i>=0){s=this.obs()[i];if(t(s,r)){var o=e.sync.applyUpdates(s,r);this.obs.splice(i,1,o)}}return i},_delete:function(e){var t=this._map.indexOf(e);t>=0&&this.obs.splice(t,1)},_local:function(t){_.each(t,function(t,n){switch(t.status){case"create":this.store.create(e.sync.prepStoreData(t.data,this.store));break;case"update":this.store.update(n,e.sync.prepStoreData(t.data,this.store));break;case"delete":this.store.delete(n);break;case"move":break;default:throw new Error("Invalid change status: "+t.status)}}.bind(this))},_then:function(e){return e=e.bind(this),this.ready=this.ready.then(function(){var t=_.Deferred();return _.when(e()).always(t.resolve),t}),this}})}(window.ko),function(e){"use strict";ko.sync.Factory=Class.extend({init:function(e,t){this.store=e,this.opts=t||{}},make:function(e,t){var n=_.pick(t,this.store.getFieldNames());return this.opts.observedFields&&ko.utils.arrayForEach(this.opts.observedFields,function(e){n[e]=_.isArray(n[e]?ko.observableArray(e):ko.observable(e))}),this.opts.isObservable?ko.observable(n):n}})}(jQuery),function(e){"use strict";ko.sync.KeyMap=function(e,t){this._subs=[],this._idx={},this._init(e,t)},ko.utils.extend(ko.sync.KeyMap.prototype,{indexOf:function(e){return this.hasKey(e)?this._idx[e]:-1},hasKey:function(e){return _.has(this._idx,e)},_changed:function(e){var t=this._idx;_.each(e,function(e,n){switch(e.status){case"delete":delete t[n];break;case"create":case"update":case"move":t[n]=e.idx;break;default:throw new Error("Invalid change status: "+e.status)}})},_init:function(e,t){_.each(ko.sync.unwrapAll(t),function(t,n){this._idx[e.getKey(t)]=n}),this._subs.push(t.watchChanges(e,this._changed.bind(this)))},dispose:function(){_.each(this._subs,function(e){e.dispose()}),this._idx=null,this._subs=null}})}(jQuery),function(e){"use strict";e.sync.Store=Class.extend({getKey:function(e){throw new Error("Implementations must declare getKey method")},getFieldNames:function(){throw new Error("Implementations must declare getFieldNames method")},create:function(e){throw new Error("Implementations must declare create method")},read:function(e){throw new Error("Implementations must declare read method")},update:function(e,t){throw new Error("Implementations must declare update method")},"delete":function(e){throw new Error("Implementations must declare delete method")},on:function(e,t,n){throw new Error("Implementations must declare on events for add, remove, and change")},dispose:function(){throw new Error("Implementations must declare dispose method")}})}(window.ko);